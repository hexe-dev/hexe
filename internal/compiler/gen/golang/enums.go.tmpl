{{- define "enums" -}}

//
// Enums
//
{{ range $enum := .Enums }}
type {{ $enum.Name }} {{ $enum.Type }}

const (
	{{- range $i, $key := $enum.Keys }}
	{{- if ne $key.Name "_" }}
	{{ $enum.Name }}_{{ $key.Name }} {{ $enum.Name }} = {{ $key.Value }}
	{{- end }}
	{{- end }}
)

func (e *{{ $enum.Name }}) UnmarshalJSON(data []byte) error {
	data = bytes.TrimSpace(data)
	if len(data) == 0 || bytes.Equal(data, []byte("null")) {
		return nil
	}

	if data[0] < '0' || data[0] > '9' {
		var s string
		if err := json.Unmarshal(data, &s); err != nil {
			return err
		}

		switch strings.ToLower(string(s)) {
		{{- range $key := $enum.Keys }}
		{{- if ne $key.Name "_" }}
		case "{{ $key.Name | ToSnakeCase }}":
			*e = {{ $enum.Name }}_{{ $key.Name }}
		{{- end }}	
		{{- end }}
		default:
			return fmt.Errorf("{{ $enum.Name }} invalid enum value: %s", string(data))
		}
	}
	
	var temp int8
	if err := json.Unmarshal(data, &temp); err != nil {
		return fmt.Errorf("{{ $enum.Name }} must be string or number, got %s: %w", string(data), err)
	}

	*e = {{ $enum.Name }}(temp)

	return nil
}

func (e *{{ $enum.Name }}) UnmarshalText(text []byte) error {
	switch strings.ToLower(string(text)) {
	{{- range $key := $enum.Keys }}
	{{- if ne $key.Name "_" }}
	case "{{ $key.Name | ToSnakeCase }}":
		*e = {{ $enum.Name }}_{{ $key.Name }}
	{{- end }}	
	{{- end }}
	default:
		return fmt.Errorf("invalid enum value: %s", string(text))
	}
	return nil
}

func (e {{ $enum.Name }}) MarshalText() ([]byte, error) {
	name := e.String()
	if name == "" {
		return nil, fmt.Errorf("invalid enum {{ $enum.Name }} value: %v", e)
	}
	return []byte(name), nil
}

func (e {{ $enum.Name }}) String() string {
	var name string
	switch e {
	{{- range $key := $enum.Keys }}
	{{- if ne $key.Name "_" }}
	case {{ $enum.Name }}_{{ $key.Name }}:
		name = "{{ $key.Name | ToSnakeCase }}"
	{{- end }}
	{{- end }}
	default:
		name = ""
	}
	return name
}

{{ end }}

{{- end }}